{% extends 'base.html' %}

{% block content %}
    <!--Общая информация----------------------------------------------->
    <nav class="uk-navbar-container uk-navbar-transparent" uk-navbar>
        <div class="uk-navbar-center">
            <ul class="uk-navbar-nav">
                <li class="uk-active">
                    <a class="uk-navbar-item uk-logo" href="#">
                        <img src="/static/img/logo.jpg" alt="None"> </a>
                </li>
                <li>
                    <a class="uk-link-reset" href="#">Контакты:</a>
                </li>
                <ul class="uk-navbar-nav">
                    <li><a class="uk-link-reset" href="#">83513527785</a></li>
                    <li><a class="uk-link-reset" href="#">83513532265</a></li>
                </ul>
            </ul>
        </div>
        <div class="uk-navbar-item">
                <form class="uk-search uk-search-navbar">
                    <span uk-search-icon></span>
                    <input id="search" class="uk-search-input" type="search" placeholder="Поиск"
                           autocomplete="off">
                </form>
            </div>
    </nav>
    <!--Всплывающие сообщения------------------------------------------>
    {% if message %}
        {% if message_type == "danger" %}
            <div class="uk-margin-large-top uk-margin-large-bottom uk-text-center">
                <div class="uk-alert-danger" uk-alert>
                    <a class="uk-alert-close" uk-close></a>
                    <p>{{ message }}</p>
                </div>
            </div>
        {% else %}
            <div class="uk-margin-large-top uk-margin-large-bottom uk-text-center">
                {% if overflow %}
                    <div class="uk-alert-warning" uk-alert>
                        <a class="uk-alert-close" uk-close></a>
                        <h3>Группа заполнена, вы записаны в резерв</h3>
                        <p>Ваша запись успешно зарегистрирована</p>
                        <p>Ожидайте приглашения на родительское собрание (в конце августа) для оформления пакета
                            документов:</p>
                        <ul>
                            <li>Заявление</li>
                            <li>Согласие на фото и видеосъемку</li>
                            <li>Копию свидетельства о рождении ребенка, либо копию паспорта ребенка (для детей старше
                                14)
                            </li>
                        </ul>
                        <p>Можете <a href="/documents/{{ pair_id }}">скачать подготовленное специально для Вас Заявление и Согласие</a>
                        , распечатать и принести бумаги в ДДТ Юность в дни приема</p>
                        <p>Так же Вам доступны образцы бланков документов для самостоятельного заполнения - <a href="/download/documents.zip">скачать</a></p>
                        <p>*Расписание является предварительным, возможна корректировка</p>
                    </div>
                {% else %}
                    <div class="uk-alert-success" uk-alert>
                        <a class="uk-alert-close" uk-close></a>
                        <p>Ваша запись успешно зарегистрирована.</p>
                        <p>Ожидайте приглашения на родительское собрание (в конце августа) для оформления пакета
                            документов:</p>
                        <ul>
                            <li>Заявление</li>
                            <li>Согласие на фото и видеосъемку</li>
                            <li>Копию свидетельства о рождении ребенка, либо копию паспорта ребенка (для детей старше
                                14)
                            </li>
                        </ul>
                        <p>Можете <a href="/documents/{{ pair_id }}">скачать подготовленное специально для Вас Заявление и Согласие</a>
                        , распечатать и принести бумаги в ДДТ Юность в дни приема</p>
                        <p>Так же Вам доступны образцы бланков документов для самостоятельного заполнения - <a href="/download/documents.zip">скачать</a></p>
                        <p>*Расписание является предварительным, возможна корректировка</p>
                    </div>
                {% endif %}
            </div>
        {% endif %}
    {% endif %}

    <!--Карточки курсов с меню----------------------------------------------->

    <div class="uk-container-large uk-margin-medium-left">
        <button class="uk-button uk-button-primary" type="button" uk-toggle="target: #offcanvas-nav">ФИЛЬТР</button>
    </div>
    <div uk-filter="target: .js-filter" class="uk-margin-small-top">

        <!--Меню----------------------------------------------->
        <div id="offcanvas-nav" uk-offcanvas="mode: push; overlay: true">
        <div class="uk-offcanvas-bar">
            <ul class="uk-nav-primary uk-nav-parent-icon" uk-nav>
                <li class="uk-active" uk-filter-control><a href="#">ПОКАЗАТЬ ВСЕ</a></li>
            </ul>
            <span class="uk-nav-header">Выбрать площадку</span>
            <ul class="uk-subnav uk-subnav-pill">
                {% for area in areas %}
                <li uk-filter-control="filter: [data-area='{{ area }}']; group: data-area"><a
                        href="#">{{ area }}</a></li>
                {% endfor %}
            </ul>
            <span class="uk-nav-header">Выбрать направление</span>
            <ul uk-accordion="multiple: true">
                <li>
                    <a class="uk-accordion-title">Художественная направленность</a>
                    <div class="uk-accordion-content">
                        <ul class="uk-subnav uk-subnav-pill">
                        {% for direction in directions['Художественная'] %}
                        <li uk-filter-control="filter: [data-direction='{{ direction }}']; group: data-direction"><a
                                href="#">{{ direction }}</a></li>
                        {% endfor %}
                        </ul>
                    </div>
                </li>
                <li>
                    <a class="uk-accordion-title">Физкультурно-спортивная направленность</a>
                    <div class="uk-accordion-content">
                        <ul class="uk-subnav uk-subnav-pill">
                        {% for direction in directions['Физкультурно-спортивная'] %}
                        <li uk-filter-control="filter: [data-direction='{{ direction }}']; group: data-direction"><a
                                href="#">{{ direction }}</a></li>
                        {% endfor %}
                        </ul>
                    </div>
                </li>
                <li>
                    <a class="uk-accordion-title">Социально-гуманитарная направленность</a>
                    <div class="uk-accordion-content">
                        <ul class="uk-subnav uk-subnav-pill">
                        {% for direction in directions['Социально-гуманитарная'] %}
                        <li uk-filter-control="filter: [data-direction='{{ direction }}']; group: data-direction"><a
                                href="#">{{ direction }}</a></li>
                        {% endfor %}
                        </ul>
                    </div>
                </li>
                <li>
                    <a class="uk-accordion-title">Техническая направленность</a>
                    <div class="uk-accordion-content">
                        <ul class="uk-subnav uk-subnav-pill">
                        {% for direction in directions['Техническая'] %}
                        <li uk-filter-control="filter: [data-direction='{{ direction }}']; group: data-direction"><a
                                href="#">{{ direction }}</a></li>
                        {% endfor %}
                        </ul>
                    </div>
                </li>
                <li>
                    <a class="uk-accordion-title">Естественно-научная направленность</a>
                    <div class="uk-accordion-content">
                        <ul class="uk-subnav uk-subnav-pill">
                        {% for direction in directions['Естественно-научная'] %}
                        <li uk-filter-control="filter: [data-direction='{{ direction }}']; group: data-direction"><a
                                href="#">{{ direction }}</a></li>
                        {% endfor %}
                        </ul>
                    </div>
                </li>
                <li>
                    <a class="uk-accordion-title">Туристско-краеведческая направленность</a>
                    <div class="uk-accordion-content">
                        <ul class="uk-subnav uk-subnav-pill">
                        {% for direction in directions['Туристско-краеведческая'] %}
                        <li uk-filter-control="filter: [data-direction='{{ direction }}']; group: data-direction"><a
                                href="#">{{ direction }}</a></li>
                        {% endfor %}
                        </ul>
                    </div>
                </li>
            </ul>
            <span class="uk-nav-header">Выбрать возраст</span>
            <ul class="uk-subnav uk-subnav-pill">
                {% for age in [5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17] %}
                <li uk-filter-control="filter: [data-age*='{{ age }}']; group: data-age"><a href="#">{{ age }}
                    лет</a></li>
                {% endfor %}
            </ul>
            <span class="uk-nav-header">Федеральный проект</span>
            <ul class="uk-subnav uk-subnav-pill">
                <li uk-filter-control="filter: [data-code='1']">
                <a href="#">IT-Куб</a></li>
                <li uk-filter-control="filter: [data-code='2']">
                    <a href="#">Успех каждого ребёнка</a></li>
            </ul>
            </div>
        </div>

        <!--Карточки курсов----------------------------------------------->
        <ul class="js-filter uk-child-width-1-3@m uk-text-center uk-grid-match" uk-grid="masonry: true">
            {% for course in courses %}
                {% if course.age_from and course.age_to %}
                    {% set ages = range(course.age_from, course.age_to + 1)|join(' ') %}
                {% endif %}
                <li class="courseCard" data-area="{{ course.area }}" data-direction="{{ course.direction }}" data-age="{{ ages }}"
                    data-code="{{ course.code }}">
                    <div class="uk-card uk-card-default uk-box-shadow-hover-small uk-border-rounded">
                        <div class="uk-card-header">
                            <div class="uk-grid-small uk-flex-middle" uk-grid>
                                <div class="uk-width-expand">
                                    <h3 class="uk-card-title uk-margin-remove-bottom">{{ course.name }}</h3>
                                    {% if course.free == false %}
                                        <span class="uk-label uk-label-warning">Обучение платное</span>
                                    {% endif %}
                                    {% if course.certificate %}
                                        <span class="uk-label">Обучение по сертификату</span>
                                    {% endif %}
                                    {% if course.id == 21 %}
                                        <p>Необходим отбор по <a href="https://innovationcampus.ru/itschool/">ссылке</a></p>
                                    {% elif course.id in (35, 36, 55, 56) %}
                                        <p>Запись и отбор по <a href="https://academy.yandex.ru/lyceum">ссылке</a></p>
                                    {% endif %}
                                    <p>{{ course.area }}</p>
                                    {% for teacher in course.teachers %}
                                        <p> {{ teacher }} </p>
                                    {% endfor %}
                                    <p class="uk-text-meta uk-margin-remove-top">
                                        С {{ course.age_from }} до {{ course.age_to }} лет
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="uk-card-body">
                            <p>{{ course.description }}</p>
                        </div>
                        <div class="uk-card-footer">
                            <p class="uk-text-center">Выбрать группу</p>
                            {% for group in course.groups %}
                                {% if group.opened %}
                                    <div class="uk-inline">
                                        <button class="uk-button uk-button-text uk-text-primary">
                                            Группа {{ group.number }}</button>
                                        <div uk-dropdown="pos: top-left">
                                            <p class="uk-text-primary">{{ group.schedule }}</p>
                                            <a href="/registration?course={{ course.id }}&group={{ group.id }}"
                                               class="uk-button uk-button-primary">Записаться</a>
                                        </div>
                                    </div>
                                {% endif %}
                                <br>
                            {% endfor %}
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>
    <script>
        let courses = Array.from(document.getElementsByClassName('courseCard'));
        const search_input = document.getElementById('search');
        let search_term = '';
        search_input.addEventListener('input', e => {
            search_term = e.target.value;
            showCourses();
        });
        console.log(courses[0]);
        const showCourses = async () => {
            courses.forEach(course => {course.setAttribute('hidden', true)});
            courses
                .filter(course =>
                    course.outerHTML.toLowerCase().includes(search_term.toLowerCase()))
                .forEach(course => {
                    course.removeAttribute('hidden');
                })
        }
    </script>
{% endblock %}
